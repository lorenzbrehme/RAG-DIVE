<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Conversation Viewer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
    }
    .conversation {
      margin-top: 20px;
    }
    .entry {
      margin-bottom: 20px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 10px;
    }
    .entry-type {
      font-weight: bold;
      color: #333;
    }
    pre {
      background: #f5f5f5;
      padding: 10px;
      overflow-x: auto;
    }
  </style>
</head>
<body>

  <h1>Conversation Viewer</h1>

  <input type="file" id="jsonFileInput" accept=".json">
  <button onclick="loadJSON()">Load JSON</button>

  <div class="conversation" id="conversationContainer"></div>

  <button onclick="nextConversation()" style="margin-top: 20px;">Next Conversation</button>
  <button onclick="prevConversation()" style="margin-top: 20px;">Previous Conversation</button>
  <input type="number" id="gotoIndex" placeholder="Go to index" style="width: 100px; margin-top: 20px;">
  <button onclick="goToConversation(document.getElementById('gotoIndex').value)">Go</button>
  <script>
    let conversations = [];
    let currentIndex = 0;

    function loadJSON() {
      const fileInput = document.getElementById('jsonFileInput');
      if (!fileInput.files.length) {
        alert("Please select a JSON file.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          conversations = JSON.parse(e.target.result);
          currentIndex = 0;
          displayConversation();
        } catch (err) {
          alert("Invalid JSON file.");
        }
      };
      reader.readAsText(fileInput.files[0]);
    }

    function displayConversation() {
      const container = document.getElementById('conversationContainer');
      container.innerHTML = '';

      if (!conversations.length || currentIndex >= conversations.length) {
        container.innerHTML = '<p>No more conversations.</p>';
        return;
      }

      const convo = conversations[currentIndex];
      const title = `<h2>${convo.title || "Untitled Conversation"}</h2>`;
      const document2 = ` <details>
        <summary><strong>Document</strong></summary>
        <p>${convo.document || "No document available."}</p>
      </details> `;

      // const entries = convo.conversation.map(entry => `
      //   <div class="entry">
      //     <p><strong>Rag-Input:</strong> ${entry.rag_input}</p>
      //     <p><strong>RAG Answer:</strong> ${entry.rag_answer}</p>
      //   </div>
      // `).join('');
      const entries = convo.conversation.map(entry => `
        <div class="entry">
          <p><strong>Rag-Input:</strong> ${entry.rag_input}</p>
          <p><strong>Stand Alone Question:</strong> ${entry.question}</p>
          <p><strong>Ground Truth Answer:</strong> ${entry.answer}</p>
          <p><strong>RAG Answer:</strong> ${entry.rag_answer}</p>
          <p><strong>Question Type:</strong> ${entry.type}</p>
        </div>
      `).join('');

      container.innerHTML = title + document2 +entries;
    }

    function nextConversation() {
      if (currentIndex < conversations.length - 1) {
        currentIndex++;
        displayConversation();
      } else {
        alert("This is the last conversation.");
      }
    }
    function prevConversation() {
      if (currentIndex > 0) {
        currentIndex--;
        displayConversation();
      } else {
        alert("This is the first conversation.");
      }
    }
    function goToConversation(index) {
      if (index >= 0 && index < conversations.length) {
        currentIndex = index;
        displayConversation();
      } else {
        alert("Invalid conversation index.");
      }
    }
  </script>

</body>
</html>
